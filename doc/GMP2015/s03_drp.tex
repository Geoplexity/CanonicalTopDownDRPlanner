\section{The canonical DR-plan}
\label{sec:DRP}
% In the problem of the optimal DR-Plan there is generally not a unique plan.
% % Indeed, we will prove a union of $N$ isostatic subgraphs will result in $N$ unique plans, but that at the $N^{\text{th}}$ level of the tree it will always be the same. Therefore, all choices of decomposition are in some sense equivalent. The theorem we seek to prove is thus:
% However, we will show that regardless of which children are chosen for the plan, so long as they satisfy the definition of an optimal DR-plan, the recombination will require solving of the same systems. Being the smallest such structure that offers this, the definition of an optimal DR-plan could be considered the canonical DR-plan.
% % To assist in showing this, we prove this core theorem throughout this section:

% In this section, we discuss 2D bar-joint graphs. All vertex weights are $2$, all edge weights are $1$, and constant $k= -{{3}\choose{2}}=-3$. Trivial graphs are a single vertex and empty set. Furthermore, 2D isostatic graphs must be connected.
% % The greatest density of a 2D isostatic graph is $-2$ (the vertex). The other disconnected part of the graph would need to have a density of $-1$, which is overconstrained and not possible in a isostatic graph (because there is no trivial graph with that density).

The NP-hardness of the DR-planning problem for 2D bar-joint graphs is partly
the consequence of possibly exponential number of DR-plans. On
the other hand, although the complete DR-plan is unique
it could have large average fan-in and exponentially many nodes making it
far from optimal.

In this section we define a \dfn{canonical} plan to capture those aspects of an optimal
DR-plan that mimic a complete DR-plan's uniqueness, while for independent
(underconstrained or isostatic graphs), we show that the nonunique parts do not affect
optimality.

\begin{definition}\label{def:canonical_drplan}
    The \dfn{canonical DR-plan} satisfies the following three properties:
    (1) it is a DR-plan;
    (2) children are rigid vertex-maximal proper subgraphs of the parent; and
    (3) if all pairs of rigid vertex-maximal proper subgraphs intersect trivially then all of them are children, otherwise take as children exactly two that intersect non-trivially.
\end{definition}

This definition gives the canonical DR-plan a surprisingly strong Church-Rosser property.

\begin{theorem}
\label{theorem:canonical_exists_and_is_optimal}
\label{theorem:canonical_is_optimal}
\label{theorem:main}
    A canonical DR-plan exists and any canonical DR-plan is optimal.
\end{theorem}


% \begin{theorem} \label{theorem:canonical_is_optimal}
%     \label{theorem:main}
%     Any canonical DR-plan is an optimal DR-plan.
% \end{theorem}

%The proof of this theorem is a direct consequence of the following  more general theorem.

%\begin{theorem}\label{theorem:main}
%Given an isostatic 2D bar-joint graph $G$ and ComDRP$(G)$, for all nodes $C$
%with children $C_1,\ldots,C_N$ preserve children according to the following rules.
%\begin{enumerate}
%    \item If $C_i \cap C_j$ is trivial then keep all $C_1,\ldots,C_N$ as children.
%    \item If $C_i \cap C_j$ is isostatic then select any two out of $C_1,\ldots,C_N$ as children.
%\end{enumerate}
%This is a canonical DR-plan.
%\end{theorem}


This theorem (proven in the Appendix) relies on the following crucial observation and lemma
that are also used for other types of qusecs in the Application sections (\ref{sec:bodypin}, \ref{sec:pinnedline}) of
the paper.

\begin{observation}\label{lemma:union_intersection}
If $F_i$ and $F_j$ are isostatic subgraphs of the same
isostatic graph $F$, \
then the following hold:
(1) $F_i\cup F_j$ is not trivial;
(2) $F_i\cup F_j$ is underconstrained if and only if $F_i\cap F_j$ is trivial;
(3) $F_i\cup F_j$ is isostatic if and only if $F_i\cap F_j$ is isostatic; and
(4) $F_i\cap F_j$ is not underconstrained.
\end{observation}

Then the following key properties hold at the nodes of a canonical DR-plan.

\begin{lemma}\label{lemma:combined_lemma}
Let $C$ be a node of a canonical DR-plan, with distinct children $C_i$ and $C_j$
Then
\begin{enumerate}
    \item\label{lemma:wc_intersection_is_C}
    $C_i\cup C_j$ is isostatic if and only if $C_i\cup C_j = C$.

    \item\label{lemma:wc_intersection_makes_all_wc}
    If $C_i\cup C_j$ is isostatic, then $\forall k: C_i\cup C_k$ is isostatic Alternatively, if $C_i\cup C_j=C$, then $\forall k: C_i\cup C_k=C$.

    \item\label{lemma:uc_intersection_makes_all_uc}
    If $C_i\cap C_j$ is trivial, then $\forall k: C_i\cap C_k$ is trivial.
\end{enumerate}
\end{lemma}

\begin{remark}
The first item in the above lemma generalizes to the union of any number of
children, $C_1,\ldots,C_k$, resulting in the desirable property of \dfn{Cluster
Minimality},
defined in \cite{hoffman2001decompositionI}
holding for these canonical-optimal DR-plans.
\end{remark}






\begin{figure*}\centering
\begin{subfigure}{.3\linewidth}\centering
    \input{img/tikz/c2c3_of_k33s-0.tikz}
    \caption{}\label{fig:c2c3ofk33s:a}
\end{subfigure}%
\begin{subfigure}{.7\linewidth}\centering
    \input{img/tikz/c2c3_of_k33s-1.tikz}
    \caption{}\label{fig:c2c3ofk33s:b}
\end{subfigure}

\caption{(\ref{fig:c2c3ofk33s:a}) A doublet ($C_2 \times C_3$) with each edge of the triangles replaced by a $K_{3,3}$. This pattern continues inwards for a total of $N$ triangles, indicated by the dashed lines. (\ref{fig:c2c3ofk33s:b}) Most of the DR-plan of this graph, omitting further decomposition of $K_{3,3}$ subgraphs into the separate 9 edges and of edges into the component nodes. $G\setminus\{a_i,b_i,c_i\}$ is shorthand for $G$ difference those nodes and all of the nodes in the corresponding $K_{3,3}$ subgraphs. The dashed lines indicated that this exact structure is repeated.}
\label{fig:c2c3ofk33s}
\end{figure*}

\myexample
\textsl{[DR-Plan for self-similar structure]}
This section details the decomposition of the graph in Figure \ref{fig:c2c3ofk33s}. The graph $G$ has only two isostatic vertex-maximal subgraphs, $G$ without the outermost triangle composed of $K_{3,3}$ graphs (triangle $1$) and $G$ without the inner triangle $N$. These intersect on $G$ without triangle $1$ and $N$ which is clearly isostatic. As explained in the proof of Theorem \ref{theorem:main} since there are only 2 possible children, their intersection must be a node 2 levels below the parent. Just as expected, it is on the third level, as it is a child of both of $G$'s children. Furthermore, it intersects trivially with the edges that connect triangle $1$ and $N$ to $2$ and $N-1$, respectively; these necessarily intersect with triangle $1$ and $N$ themselves trivially (by Theorem \ref{theorem:main}, part 1) making all of these children. The triangles then decompose into their constituent $K_{3,3}$ graphs, which then decompose into 9 edges.

Now, the self-similar nature of the graph is clear; $G$ without triangle $1$ and $N$ has the same structure, and thus the same pattern is repeated until only triangle $(N+1)/2$ remains in the case that $N$ is odd, or until only triangles $N/2$ and $N/2+1$ remain if $N$ is even.


% \begin{example}
%     In
% \end{example}




% \subsection{Extensions}
% This framework immediately pushes through for body-pin systems via a simple reduction. If there are $N$ pins on a body, it can be represented as a 2-tree with $N$ vertices, each corresponding to a pin, making sure to select edge distances such that the distance between pins is preserved. E.g.\ a body with two pins is an edge, three pins is a triangle, etc. Any bodies that share a pin now intersect on their vertex that corresponds to that pin. Now we have a bar-joint representation of the body-pin system in 2D and all proofs follow.

% With more effort, it can be shown that pinned line-incidence systems can also use this framework. This is done in section \ref{XXX}.


% \subsection{Algorithm}

\begin{theorem}\label{theorem:algo_complexity}
    There exists an \candrpcomplexityv algorithm to find a canonical DR-plan for any 2D isostatic bar-joint graph.
\end{theorem}

\begin{remark}
    While the canonical DR-plan is optimal only if the input graph is independent, if it has only $k$ overconstraints for some fixed $k$, we can still find the optimal DR-plan. However, the time complexity is exponential in $k$.
\end{remark}
