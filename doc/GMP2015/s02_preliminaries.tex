\section{Preliminaries}
\label{sec:prelim}

\subsection{Basics}
%TODO!



In this paper, a {\em geometric constraint system} is a multivariate polynomial 
(usually bilinear or quadratic) system $G(x,\delta)=0$, representing constraints with parameters $\delta$ 
between geometric primitives  in $\mathbb{R}^2$ represented collectively $x\in \mathbb{R}^n$.   
%
When the type of constraint (system) is fixed, the system is simply represented as $(G,\delta)$, where 
$G$ is the underlying constraint (hyper)graph $G = (V,E)$ 
with the vertices $V$ representing the geometric primitives in 
$\mathbb{R}^2$ and (hyper)edges
$E$ representing the constraints, each with an associated 
parameter $\delta$.
%
For example, a {\em bar-joint system or linkage} $(G,\delta)$, is a graph
$G=(V,E)$  
with fixed length bars as edges, i.e. $\delta: E \rightarrow \mathbb{R}$;
this represents the distance constraint system $\| x_u -x_v \|_2 =
\delta_{u,v}$ for  $(u,v) \in E$, where $x_u \in \mathbb{R}^2$ represents the coordinates of
$u\in V$. 

In this paper, we will consider 3 types of constraint systems: bar-joint
as well as {\em pinned line-incidence}, and {\em body-hyperpin}. 
In all of these cases, a cartesian \emph{realization} or 
\emph{solution} $G(p)$ of $(G,\delta)$ is 
an assignment of coordinates or Euclidean transformations (poses), 
$p: V \rightarrow \mathbb{R}^2$ or $\mathbb{R}^3$, to the vertices of $G$ satisfying the 
constraints with parameters $\delta$, 
modulo orientation preserving isometries 
(Euclidean rigid body motions for distance constraint). 

Although the realization space itself depends on the constraint parameters 
$\delta$, many  relevant {\em generic} properties of 
the constraint system $G(x,\delta)$
are properties of the constraint (hyper)graph $G$ 
and do not depend on $\delta$ (or they hold for all but a measure 
zero set of $\delta$
values). Many of these are properties of the jacobian 
$\Delta_x G(x,\delta)$, often called the appropriate {\em rigidity matrix of
$G$} 
(a matrix of indeterminates).
For example, the {\em bar-joint rigidity matrix 
of the graph $G = (V,E)$}
is a matrix of indeterminates representing the 
jacobian of the distance map 
$\| x_u -x_v \|_2$  for $(u,v) \in E$.
The matrix has $2$ columns per vertex in $V$ and one row per edge  in $E$, 
where the row corresponding to edge $(u,v)$ contains the 2 coordinate indeterminates 
for $x_u -x_v$ (resp. $x_v-x_u$) in the 2 columns for $u$ (resp.\ $v$), 
that is 4 non-zero entries per row. 

Some of these generic constraint system or 
(hyper)graph properties are the following ({\bf Note:} we refer to these as
properties of the constraint system or as properties of the underlying
(hyper)graph interchangeably).
%
A constraint (hyper)graph $G$ is {\em independent} if its appropriate rigidity matrix of indeterminates  
has independent rows
(i.e, the determinant of some square submatrix is not
identically zero). 
It is {\em rigid} if the number of independent rows of the rigidity matrix is
at least the number of columns less the number of rigid body motions, 
which is 3 for distance constraint systems. 
It is {\em isostatic (minimally rigid, well-constrained)} 
if it is both rigid and independent. 
%if the number of generically independent rows or the rank of the appropriate rigidity matrix is maximal.
%For example, the maximal rank of a bar-joint rigidity matrix is $2|V| - 3$, 
%where $3$ is the number of rotational and translational degrees-of-freedom of a rigid body in $\mathbb{R}^2$.
%The graph $G$ is {\em rigid} if there exists some spanning subgraph $S\subseteq G$ such that $S$ is well-constrained. 
It is {\em flexible} if it is not rigid, {\em under-constrained} if it is independent and not rigid, or {\em over-constrained} if it is not independent.


In this paper, a {\em qusec} is any {\em independent} geometric 
constraint system of one of the 3
types mentioned above.



%Define rigidity matroid and combinatorial characterization of independence/rigidity next
%Laman's theorem (for bar-joint rigidity matroid), 
%cite also Lovasz Yemini
%Cite other combinatorial characterizations for other types of constraint systems/hyper graphs:
%Tay and Whiteey, White and Whitelely,  
%Streinu Theran (k,l)-sparsity matroid

The 2-dimensional {\em rigidity matroid} of a constraint (hyper)graph $G = (V,E)$ is a linear matroid  on $E$, 
where a subset of edges $E' \subseteq E$ is {\em independent} in the matroid, 
if the set of corresponding rows in the appropriate rigidity matrix of indeterminates are linearly independent. 

There exist various results on combinatorial characterization of independence and rigidity
for different types of  rigidity matroid. 
For bar-joint rigidity matroid, 
the famous Laman's theorem~\cite{???} states that the underlying graph
is minimally rigid if and only if $|E| = 2|V|-3$ and $|E'| \le 2|V'|-3$ for every induced subgraph with at least 2 vertices. 
The result by Lovasz and Yemini~\cite{???} shows that all 6-vertex-connected graphs are rigid in the plane. 
For bar-body rigidity matroid,
Tay~\cite{???} proved that
the underlying multigraph is minimally rigid if and only if it can be decomposed as $3$ edge disjoint spanning trees. 
White and Whiteley~\cite{???} gave the same characterization using a different technique to study the algebraic - geomtric conditions called pure condition.
More generally, 
Lee, Streinu and Theran~\cite{???} defined the $(k,l)$-sparsity matroid,
where a hypergraph is called $(k,l)$-sparse if $|E'| \le k|V| - l$ for any induced subgraph with at lease 2 vertices.  

% % % % % % % % % % % % % % % % % % % % % % % % % % %

%A subset of edges $E'$, or a subgraph $(V', E')$, of a graph $G = (V, E)$ is said to be {\it independent} in $d$-dimensions, when the set of rows of $R_d(G)$ corresponding to $E'$ is generically independent, or independent for a generic instantiation of the indeterminate entries. 
%This yields the $d$-dimensional generic {\it rigidity matroid} associated with a graph $G$. 

%The graph is  {\it infinitesimally rigid} if %the rigidity matrix has full rank, that is, 
%if the number of generically independent rows or the rank of $R_d(G)$ is maximal.
%In the case of linkage, the maximal rank is $d|V| - {d+1 \choose 2}$, where ${d+1 \choose 2}$ is the number of rotational and translational degrees-of-freedom of a rigid body in $\mathbb{R}^d$ [?].
%A vector in the kernel of the rigidity matrix is called an {\it infinitesimal motion vector}.

%A graph $G = (V,E)$ is:
%\begin{itemize}
%	\item generically {\it isostatic (minimally rigid, well-constrained)} if $R_d(G)$ has full rank
%	\item \textbf{rigid} if there exists some spanning subgraph $S\subseteq G$ such that $S$ is well-constrained.
%	\item {\it flexible} if $G$ is not rigid
%    \item \textbf{under-constrained} if $G$ is independent and not rigid.
%    \item \textbf{over-constrained} if it is not independent.
%\end{itemize}
%In this paper all results are about independent - underconstrained or
%isostatic


For bar-joint graphs,  
a vector  in the right null space of its rigidity matrix
is called a {\em flex vector}. 
It has 2 entries of indeterminates per vertex and represents the internal motions of the system
(i.e.\ modulo rigid body motions).
For rigid graphs, all flex vectors are  identically zero. 
A vector in the left null space of the rigidity matrix
is called a {\em stress vector}, with one entry of indeterminate per edge.
For independent graphs, all stress vectors are identically zero. 



%--A generalized version of Asimow Roth (implicit fn thm)
%generic rigidity equivalent to infinitesimal rigidity (easy
%when the latter def is based on indeterminates)

% A generalized version of Asimow Roth (implicit fn thm) states that
% generic rigidity, i.e.\ there exist at most finitely many solutions to the system at generic points,  %to the algebraic system 
%  is equivalent to  our definition  of infinitesimal rigidity based on indeterminates.


%\todo{--rigidity matroid\\
%--Combinatorial characterization of rigidity matroid
%Example: Laman's theorem for bar-joint (refer to others)
%Lovasz Yemini
%Tay white and whiteley
%(citations)
%+ pinned line incidence and multi-body-pin (in application
%section)}



% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %

%Standard except for generality and ordering and the fact that I want to
%avoid the use of the word framework if possible. Do everything
%with constraint systems, linearization and genericity using indeterminates. 

%--general  geometric constraint system --

%A $d$-dimensional {\it geometric constraint system} in general consists of
%
%- a underlying {\it constraint graph} $G=(V,E)$, or more generally, a hypergraph, whose  vertices represents geometric primitives in $d$-dimension and whose (hyper)edges specifies the combinatorics of constraints between pairs/tuples of the geometric primitives.
%- an {\it algebraic system of  constraint functions} from $E$ to the domain of constraint value
%In this paper we study qusecs, a class of 2D geometric constrain system that is independent (defined below).


%--underlying constraint graph or hypergraph (common treatment)

%--linearization: Jacobian of constraint system,
%rigidity matrix of indeterminates
%
%The algebraic system can usually be linearized at {\it generic} points
%by taking the Jacobian of the system,
%giving  the $d$-dimensional {\it rigidity matrix } $R_d(G)$ of a the (hyper)graph $G = (V,E)$, 
%whose rows correspond to edges, columns correspond to coordinate positions of vertices,  entries are \emph{indeterminates} representing the coordinate position $\mathbf{p}(v) \in \mathbb{R}^d$ of the geometric primitives corresponding to vertices $v \in V$. 

%-- give example for the case of
%linkages
%
%In the case of linkage, 
%let $p_1(v), p_2(v), \ldots, p_d(v)$ represent the coordinate position $\mathbf{p}(v) \in \mathbb{R}^d$ of the joint corresponding to a vertex $v \in V$. 
%The matrix $R_d(G)$ has one row for each edge $e \in E$ and $d$ columns for each vertex $v \in V$.  The row corresponding to $e = \{u,v\} \in E$ represents the bar connecting $p(u)$ and $p(v)$ and has $d$ non-zero indeterminate entries $\mathbf{p}(u)-\mathbf{p}(v)$ (resp.\ $\mathbf{p}(v)-\mathbf{p}(u)$) in the $d$ columns corresponding to $u$ (resp.  $v$) and zero in the other entries.  

%%Let $p_1(v), p_2(v), \ldots, p_d(v)$ represent the coordinate position $\mathbf{p}(v) \in \mathbb{R}^d$ of the joint corresponding to a vertex $v \in V$. 
%The matrix $R_d(G)$ has one row for each edge $e \in E$ and $d$ columns for each vertex $v \in V$.  The row corresponding to the hyperedge $e = \{v_1, v_2, \ldots, v_k\} \in E$ represents the constraint between the vertices $ \{v_1, v_2, \ldots, v_k\}$, 
%has $d$ non-zero indeterminate entries %$\mathbf{p}(u)-\mathbf{p}(v)$ (resp.\ $\mathbf{p}(v)-\mathbf{p}(u)$) 
%in the $d$ columns corresponding to each vertex $v_i \in e$ and zero in the other entries.  


%generic independence, infinitesimal rigidity
%(based on indeterminates)




%--stress vectors and flex vectors
%(also based on indeterminates)





%--generic isostaticity (minimal rigidity, wellconstrainedness),
%flexibility (not rigid), underconstrained (independent
%and not rigid), overconstrained (dependent -- only briefly
%mentioned
%in this paper; all results are about independent - underconstrained or
%isostatic)







% % % % % % % % % % % % % % % % % % % % % % % % % % % % %

%The problem is equivalent to combinatorially determining the generic rank of the 3-dimensional bar-joint rigidity matrix of a graph.  The $d$-dimensional bar-joint rigidity matrix of a graph $G = (V,E)$, denoted $R_d(G)$, is a matrix of indeterminates. Let $p_1(v), p_2(v), \ldots, p_d(v)$  represent the coordinate position $\mathbf{p}(v) \in \mathbb{R}^d$of the joint corresponding to a vertex $v \in V$.  . The matrix $R_d(G)$ has one row for each edge $e \in E$ and $d$ columns for each vertex $v \in V$.  The row corresponding to $e = \{u,v\} \in E$ represents the bar connecting $p(u)$ and $p(v)$ and has $d$ non-zero indeterminate entries $\mathbf{p}(u)-\mathbf{p}(v)$ (resp.\ $\mathbf{p}(v)-\mathbf{p}(u)$) in the $d$ columns corresponding to $u$ (resp.  $v$) and zero in the other entries.  
%
%A subset of edges $E'$, or a subgraph $(V', E')$, of a graph $G = (V, E)$ is said to be independent (we drop ``bar-joint'' from now on) in $d$-dimensions, when the set of rows of $R_d(G)$ corresponding to $E'$ is generically independent, or independent for a generic instantiation of the indeterminate entries. This yields the $d$-dimensional generic rigidity matroid associated with a graph $G$. The graph is rigid if the number of generically independent rows or the rank of $R_d(G)$ is maximal, i.e., $d|V| - {d+1 \choose 2}$, where ${d+1 \choose 2}$ is the number of rotational and translational degrees-of-freedom of a rigid body in $\mathbb{R}^d$ [?].




\subsection{DR-plan}
%\subsection{Definitions}
%\label{sec:prelim_defs}
%
%% TODO
%
%% A paragraph of preliminaries such as:
%%     - rigidity matrix R,
%%     - stress vectors S one coordinate per edge (w/ SR =E (external stress vector, 2 coordinates  per vertex));
%%     - flex vectors F (2 coordinates per vertex) (right nullspace/kernel of R)
%% Should precede the definition of
%%     + independent,
%%     + overconstrained (not independent),
%%     - rigid (contains an independent set with sufficiently many eedges/constraints)
%%     - isostatic (wellconstrained/minimally rigid), ,
%%     - flexible (not rigid),
%%     + underconstrained (independent and not rigid).
%% After that, define DR plans etc.
%
%In Sections \ref{sec:DRP} and \ref{sec:recomb} a \textbf{graph} is a bar and joint system. $G=(V,E,w_V,w_E)$ is a set of vertices, $V$, and a set of edges, $E$, defined as a tuple of vertices from $V$ (undirected). Additionally, there are two weight functions, $w_V: V \to \mathbb{R}^+$ and $w_E: E \to \mathbb{R}^+$. The \textbf{density} of graph $G$ is $d(G) = \sum_{e\in E}{w_E(e)} - \sum_{v\in V}{w_V(v)}$.
%
%Given a constant $k$, a graph $G$ is:
%\begin{itemize}
%    \item \textbf{independent} (or \textbf{sparse}) if, for all non-trivial subgraphs $S\subseteq G$, $d(S) \leq k$.
%
%    \item \textbf{over-constrained} if it is not independent.
%
%    \item \textbf{well-constrained} (or \textbf{tight}) if $G$ is independent and $d(G)=k$.
%
%    \item \textbf{rigid} if there exists some spanning subgraph $S\subseteq G$ such that $S$ is well-constrained.
%
%    \item \textbf{under-constrained} if $G$ is independent and not rigid.
%
%    % \item \textbf{trivial} if (1) it is over-constrained graph and (2) all of its subgraphs are also trivial. Trivial graphs are input.
%\end{itemize}
%
\textbf{Trivial} graphs are ill-defined in the general case. The only strict requirements are: (1) it must over-constrained and (2) all of its subgraphs are also trivial.

% \begin{definition}
%     A graph is \textbf{over-constrained} if, given constant $k$, there exists some
%     % induced
%     subgraph $S\subseteq G$ such that $d(S) > k$.
% \end{definition}

% \begin{definition}
%     A graph is \textbf{well-constrained} if, given constant $k$, $d(G) = k$ and for all
%     % induced
%     subgraphs $S\subseteq G$, (1) $d(S)\leq k$, or (2) given a set of trivial graphs $T$, $S$ is isomorphic to one of the graphs in $T$ (i.e.\ $S$ is trivial).
% \end{definition}



% \begin{definition}
%     A \textbf{trivial} graph is ill-defined in the general case. The only strict requirements are: (1) it must be an over-constrained graph and (2) all of its subgraphs are also trivial.
%     \todo{Maybe leave the following out until it's needed later?}
%     In the familiar geometric cases of $d$-dimensional space, all vertex weights are $d$, all edge weights are $1$, and constant $k= -{{d+1}\choose{2}}$. Trivial graphs for 2D would be a single vertex. Trivial graphs in 3D would be a vertex and an edge (2 vertices with an edge between). Etc. These trivial graphs capture the notion of the rotational symmetry that exists in geometric spaces.
% \end{definition}


\begin{definition}\label{def:drp}
    The \textbf{decomposition-recombination \mbox{(DR-)} plan} of graph $G$, $DRP(G)$, is defined as a tree that has the following properties:
    \begin{enumerate}
        \item The root of the tree `contains' $G$.
        \item For all nodes, $C$, that `contain' non-trivial graphs, its $N$ children, $C_1, \ldots, C_N$, are trivial or well-constrained vertex-maximal proper subgraphs of that node $C$.
        \item The vertex set of $\bigcup_{i=1}^N{C_i}$ is the vertex set of $C$.
        \item A node with a trivial subgraph is a leaf.
    \end{enumerate}

    % It can also be described recursively as: the root is $G$, its children are the trivial subgraphs and the DR-plans of its well-constrained vertex-maximal proper subgraphs whose union is $G$ itself.

    An equivalent DAG can be constructed from this tree such that all nodes containing the same subgraphs are combined into one, with all edges preserved.

    Note that nodes will be referred to interchangeably as ``the node that contains the (sub)graph $C$'' and as simply ``$C$''.

    A DR-plan is \textbf{complete} if it satisfies the modified rule number 2: the children are \emph{all} of the trivial or well-constrained vertex-maximal proper subgraphs of that node $C$. This makes rule 3 implicit. The complete DR-plan is unique.

    A DR-plan is \textbf{optimal} if it minimizes the maximum fan-in over all nodes in the tree. It is not necessarily unique.
\end{definition}

% \begin{definition}
%     The \textbf{complete DR-plan} of graph $G$, $CompleteDRP(G)$, is the unique DR-plan but with a modified rule number 2: the children are \emph{all} of the trivial or well-constrained vertex-maximal proper subgraphs of that node $C$. By this, rule 3 is implicit for a complete DR-plan.
% \end{definition}

% \begin{definition}
%     The \textbf{optimal DR-plan} of graph $G$, $OptimalDRP(G)$, is the DR-plan that minimizes the maximum fan-in over all nodes in the tree. It is not necessarily unique.
% \end{definition}


\subsection{Notation}

In Sections \ref{sec:DRP} and \ref{sec:recomb}, $G$ is taken to be a \emph{well-constrained} bar and joint graph with values $(V,E,w_V,w_E)$.
% \todo{I don't think the following is actually necessary to mention...} To keep problems meaningful we assume that $G$ is connected, as the methods discussed are used to solve systems of equations to establish linkages. It is not useful to solve for two bodies simultaneously if there are no constraints between them.
% THIS MEANS NO EDGES MAY BE LEFT OUT, ALSO.

$Idc(G,X)$ is the graph induced on $G$ with the vertex set $X\subseteq V$. This can also be overloaded such that, using graph $H=(W,F)$, $Idc(G,H)=Idc(G,W)$.

$C$ is the graph in an arbitrary node in $CompleteDRP(G)$. $C_i$ is the $i^{\text{th}}$ child of $C$. By definition of a DR-plan, it is implied that $C_i$ is a well-constrained vertex-maximal proper subgraph.
